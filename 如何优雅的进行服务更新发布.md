微服务更新是一个超级频繁的操作。并且有很多细节需要注意，才能保证服务能够无缝的进行更新和升级。在实际的工作中总结了一些必要的步骤，下面来详细说明一下

- 执行命令`systemctl stop`的时候，会发出143信号，`springboot`会接受这个信号，触发`ContextClosedEvent`事件。
- 在接受到`ContextClosedEvent`事件的时候，主程序应该有一段时间的等待时间（一般15秒）。因为`eureka-client`在接受到这个信号的时候，会告诉`eureka`需要把实例标记成`down`状态。需要等待其他客户端更新状态。可以通过修改相关的`eureka`的配置来缩短更新时间。
- 等待一段时间后，其他客户端都进行了更新，然后获得`tomcat`的线程池，执行`shutdown`方法，并且设置最长等待时间（一般15秒），如果到达最长时间线程池还没有正常结束，则通过`shutdownNow`方法，强制结束
- 用新的jar包替换更新之前的老jar包
- 执行命令`systemctl start`启动服务
- 等待30s后（一般启动时间为30s左右），通过访问`/actuator/health`来获得该服务的健康状态。
- 如果失败则停止后续实例的发布，如果成功则继续发下一个实例。
- 根据不同的状态进行相关的责任人的通知。